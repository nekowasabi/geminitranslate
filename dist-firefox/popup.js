(()=>{"use strict";var e,a={717:(e,a,s)=>{var t=s(848),n=s(540),r=s(338),o=(s(122),s(333)),l=s(724),i=s(444);function c(){const[e,a]=(0,n.useState)("idle"),[s,t]=(0,n.useState)(null),[r,c]=(0,n.useState)(0),d=new i.A;return{status:e,error:s,progress:r,translate:(0,n.useCallback)(async e=>{const s=(new Date).toISOString();console.log(`[Popup:useTranslation] ${s} - translate() called`,{targetLanguage:e});try{a("translating"),t(null),c(0);const n=await d.get(["openRouterApiKey","openRouterModel"]);if(!n.openRouterApiKey||""===n.openRouterApiKey.trim())throw new Error("API key is not configured. Please set your OpenRouter API key in Settings.");if(!n.openRouterModel||""===n.openRouterModel.trim())throw new Error("Model is not configured. Please set your preferred model in Settings.");console.log(`[Popup:useTranslation] ${s} - OpenRouter configuration validated:`,{hasApiKey:!0,model:n.openRouterModel});const r=e||await d.getTargetLanguage();console.log(`[Popup:useTranslation] ${s} - Target language resolved:`,r),console.log(`[Popup:useTranslation] ${s} - Sending TRANSLATE_PAGE message to background`,{type:l.G.TRANSLATE_PAGE,payload:{targetLanguage:r}});const i=await o.A.send({type:l.G.TRANSLATE_PAGE,payload:{targetLanguage:r}});if(console.log(`[Popup:useTranslation] ${s} - Received response from background:`,i),!0!==i?.success&&"completed"!==i?.status&&"started"!==i?.status)throw console.error(`[Popup:useTranslation] ${s} - Translation failed - unexpected response:`,i),new Error(i?.error||"Translation failed");console.log(`[Popup:useTranslation] ${s} - Translation successful`),a("success"),c(100)}catch(e){const n=e instanceof Error?e.message:"Unknown error";console.error(`[Popup:useTranslation] ${s} - Error during translation:`,{error:e,message:n,stack:e instanceof Error?e.stack:void 0}),a("error"),t(n),c(0)}},[]),reset:(0,n.useCallback)(async()=>{try{await o.A.send({type:l.G.RESET}),a("idle"),t(null),c(0)}catch(e){const a=e instanceof Error?e.message:"Unknown error";t(a)}},[])}}const d=n.memo(()=>{const{translate:e,reset:a,status:s}=c(),r=n.useCallback(async()=>{await e()},[e]),o=n.useCallback(async()=>{await a()},[a]),l="translating"===s,i="success"===s;return(0,t.jsxs)("div",{className:"quick-translate",children:[(0,t.jsx)("button",{onClick:r,disabled:l,className:"translate-button","aria-label":l?"Translating...":"Translate Page",children:l?"Translating...":"Translate Page"}),(0,t.jsx)("button",{onClick:o,disabled:!i,className:"reset-button","aria-label":"Reset to Original",children:"Reset to Original"})]})});var u=s(109);const g=()=>{const[e,a]=(0,n.useState)("en"),s=new i.A;return(0,n.useEffect)(()=>{(async()=>{const e=await s.getTargetLanguage();a(e)})()},[]),(0,t.jsxs)("div",{className:"language-selector",children:[(0,t.jsx)("label",{htmlFor:"target-language",children:"Target Language:"}),(0,t.jsx)("select",{id:"target-language",value:e,onChange:async e=>{const t=e.target.value;a(t),await s.setTargetLanguage(t)},"aria-label":"Select target language",children:u.Fc.map(e=>(0,t.jsx)("option",{value:e.code,children:e.name},e.code))})]})},p=n.memo(({status:e,progress:a,error:s})=>"idle"===e?null:(0,t.jsxs)("div",{className:`status-indicator ${e}`,"aria-live":"polite",role:"status",children:["translating"===e&&(0,t.jsxs)("div",{className:"translating-state",children:[(0,t.jsx)("div",{className:"status-message",children:"Translating..."}),(0,t.jsx)("div",{className:"progress-bar",role:"progressbar","aria-valuenow":a,"aria-valuemin":0,"aria-valuemax":100,children:(0,t.jsx)("div",{className:"progress-fill",style:{width:`${a}%`}})}),(0,t.jsxs)("div",{className:"progress-text",children:[a,"%"]})]}),"success"===e&&(0,t.jsxs)("div",{className:"success-state success",children:[(0,t.jsx)("img",{src:"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%234ade80' stroke-width='2'%3E%3Cpath d='M20 6L9 17l-5-5'/%3E%3C/svg%3E",alt:"success",role:"img","aria-label":"success"}),(0,t.jsx)("span",{children:"Translation successful!"})]}),"error"===e&&(0,t.jsxs)("div",{className:"error-state error",children:[(0,t.jsx)("img",{src:"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%23f87171' stroke-width='2'%3E%3Ccircle cx='12' cy='12' r='10'/%3E%3Cpath d='M15 9l-6 6M9 9l6 6'/%3E%3C/svg%3E",alt:"error",role:"img","aria-label":"error"}),(0,t.jsx)("span",{children:s||"Translation error occurred"})]})]})),x=({hasApiKey:e})=>e?null:(0,t.jsx)("div",{className:"api-key-warning warning",role:"alert",children:(0,t.jsxs)("div",{className:"warning-content",children:[(0,t.jsx)("div",{className:"warning-icon",children:"⚠️"}),(0,t.jsxs)("div",{className:"warning-message",children:[(0,t.jsx)("strong",{children:"API Key Required"}),(0,t.jsx)("p",{children:"Please configure your OpenRouter API key in Settings (⚙️)."})]})]})}),m=n.memo(()=>{const{data:e,clear:a}=function(){const[e,a]=(0,n.useState)(null),s=(0,n.useCallback)(()=>{a(null)},[]);return(0,n.useEffect)(()=>{(async()=>{try{const e=await browser.storage.session.get("lastSelectionTranslation");e.lastSelectionTranslation?(console.log("[useSelectionTranslation] Loaded from session storage:",{originalText:e.lastSelectionTranslation.originalText?.substring(0,50),translatedText:e.lastSelectionTranslation.translatedText?.substring(0,50),targetLanguage:e.lastSelectionTranslation.targetLanguage}),a(e.lastSelectionTranslation)):console.log("[useSelectionTranslation] No saved translation in session storage")}catch(e){console.error("[useSelectionTranslation] Failed to load from session storage:",e)}})();const e=(e,s,t)=>{if(e?.type===l.G.SELECTION_TRANSLATED){const s=e.payload;console.log("[useSelectionTranslation] Received runtime message:",{originalText:s.originalText?.substring(0,50),translatedText:s.translatedText?.substring(0,50),targetLanguage:s.targetLanguage}),a({originalText:s.originalText,translatedText:s.translatedText,targetLanguage:s.targetLanguage,timestamp:s.timestamp}),browser.storage.session.set({lastSelectionTranslation:s}).catch(e=>console.error("[useSelectionTranslation] Failed to save to session:",e))}};return browser.runtime.onMessage.addListener(e),()=>{browser.runtime.onMessage.removeListener(e)}},[]),{data:e,clear:s}}(),[s,r]=(0,n.useState)(!1),o=(0,n.useCallback)(async()=>{if(e)try{await navigator.clipboard.writeText(e.translatedText),r(!0),setTimeout(()=>{r(!1)},2e3)}catch(e){console.error("Failed to copy to clipboard:",e)}},[e]);return e?(0,t.jsxs)("div",{className:"selection-result-container",role:"region","aria-label":"Selection translation result",children:[(0,t.jsxs)("div",{className:"selection-result-header",children:[(0,t.jsx)("h3",{children:"Selection Translation"}),(0,t.jsxs)("span",{className:"target-language",children:["→ ",e.targetLanguage]})]}),(0,t.jsxs)("div",{className:"selection-result-content",children:[(0,t.jsxs)("div",{className:"text-section",children:[(0,t.jsx)("label",{className:"text-label",children:"Selected Text"}),(0,t.jsx)("div",{className:"original-text",children:e.originalText})]}),(0,t.jsxs)("div",{className:"text-section",children:[(0,t.jsx)("label",{className:"text-label",children:"Translation"}),(0,t.jsx)("div",{className:"translated-text",children:e.translatedText})]})]}),(0,t.jsxs)("div",{className:"selection-actions",children:[(0,t.jsx)("button",{onClick:o,className:"copy-button","aria-label":s?"Copied":"Copy translation",children:s?"Copied!":"Copy"}),(0,t.jsx)("button",{onClick:a,className:"clear-button","aria-label":"Clear translation result",children:"Clear"})]})]}):null});m.displayName="SelectionResult";const h=()=>{const[e,a]=(0,n.useState)(!1),{status:s,error:r,progress:o}=c(),l=(0,n.useMemo)(()=>new i.A,[]);return(0,n.useEffect)(()=>{(async()=>{const e=await l.getApiKey();a(!!e)})()},[l]),(0,t.jsxs)("div",{className:"popup-container",children:[(0,t.jsxs)("header",{className:"popup-header",children:[(0,t.jsx)("h1",{children:"Quick Translate"}),(0,t.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,t.jsx)("button",{onClick:()=>chrome?.runtime?.openOptionsPage(),style:{background:"none",border:"none",cursor:"pointer",fontSize:"20px",padding:"4px 8px",opacity:1,transition:"opacity 0.2s"},onMouseEnter:e=>e.currentTarget.style.opacity="0.7",onMouseLeave:e=>e.currentTarget.style.opacity="1","aria-label":"Open Settings",title:"Settings",children:"⚙️"}),(0,t.jsx)("div",{className:"extension-version",children:chrome?.runtime?.getManifest?.()?.version&&(0,t.jsxs)("span",{children:["v",chrome.runtime.getManifest().version]})})]})]}),(0,t.jsxs)("main",{className:"popup-main",children:[(0,t.jsx)(x,{hasApiKey:e}),(0,t.jsxs)("div",{className:"controls-section",children:[(0,t.jsx)(g,{}),(0,t.jsx)(d,{})]}),(0,t.jsx)(p,{status:s,progress:o,error:r}),(0,t.jsx)(m,{})]}),(0,t.jsx)("footer",{className:"popup-footer",children:(0,t.jsx)("p",{className:"footer-text",children:"Powered by OpenRouter"})})]})};document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("root");e?(0,r.H)(e).render((0,t.jsx)(n.StrictMode,{children:(0,t.jsx)(h,{})})):console.error("Root element not found")})}},s={};function t(e){var n=s[e];if(void 0!==n)return n.exports;var r=s[e]={id:e,exports:{}};return a[e](r,r.exports,t),r.exports}t.m=a,e=[],t.O=(a,s,n,r)=>{if(!s){var o=1/0;for(d=0;d<e.length;d++){for(var[s,n,r]=e[d],l=!0,i=0;i<s.length;i++)(!1&r||o>=r)&&Object.keys(t.O).every(e=>t.O[e](s[i]))?s.splice(i--,1):(l=!1,r<o&&(o=r));if(l){e.splice(d--,1);var c=n();void 0!==c&&(a=c)}}return a}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[s,n,r]},t.n=e=>{var a=e&&e.__esModule?()=>e.default:()=>e;return t.d(a,{a}),a},t.d=(e,a)=>{for(var s in a)t.o(a,s)&&!t.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:a[s]})},t.o=(e,a)=>Object.prototype.hasOwnProperty.call(e,a),(()=>{var e={887:0};t.O.j=a=>0===e[a];var a=(a,s)=>{var n,r,[o,l,i]=s,c=0;if(o.some(a=>0!==e[a])){for(n in l)t.o(l,n)&&(t.m[n]=l[n]);if(i)var d=i(t)}for(a&&a(s);c<o.length;c++)r=o[c],t.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return t.O(d)},s=self.webpackChunkdoganaylab_api_translate=self.webpackChunkdoganaylab_api_translate||[];s.forEach(a.bind(null,0)),s.push=a.bind(null,s.push.bind(s))})(),t.nc=void 0;var n=t.O(void 0,[121,956],()=>t(717));n=t.O(n)})();