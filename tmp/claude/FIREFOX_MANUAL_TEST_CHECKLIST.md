# Firefox拡張機能 手動テストチェックリスト

このドキュメントは、Firefox環境での3つの不具合修正を検証するための手動テスト項目を記載しています。

## 事前準備

- [ ] Firefox最新版をインストール済み
- [ ] `about:debugging` からテンポラリアドオンとして拡張機能をロード済み
- [ ] OpenRouter APIキーを準備済み

## テスト1: 歯車アイコンボタンの常時表示（不具合1の修正検証）

### 1.1 APIキー未設定時の表示確認

1. [ ] 拡張機能の設定をクリアし、APIキーを未設定状態にする
2. [ ] ポップアップを開く
3. [ ] **確認**: ヘッダーに歯車アイコン（⚙️）ボタンが表示されている
4. [ ] **確認**: APIキー警告バナーが表示されている
5. [ ] **確認**: 警告バナーには「Please configure your OpenRouter API key in Settings (⚙️).」というメッセージが表示されている
6. [ ] **確認**: 警告バナーに「Open Settings」ボタンが**存在しない**

### 1.2 APIキー設定後の表示確認

1. [ ] 歯車アイコンをクリックして設定画面を開く
2. [ ] OpenRouter APIキーを入力して保存
3. [ ] 設定画面を閉じる
4. [ ] ポップアップを再度開く
5. [ ] **確認**: ヘッダーに歯車アイコン（⚙️）ボタンが**引き続き表示されている**
6. [ ] **確認**: APIキー警告バナーが非表示になっている

### 1.3 歯車アイコンの動作確認

1. [ ] 歯車アイコンにマウスホバー
2. [ ] **確認**: ツールチップ「Settings」が表示される
3. [ ] **確認**: マウスホバー時に透明度が変化する（opacity: 0.7）
4. [ ] 歯車アイコンをクリック
5. [ ] **確認**: 設定画面（options.html）が新しいタブで開く

### 1.4 アクセシビリティ確認

1. [ ] Tabキーでフォーカスを歯車アイコンボタンに移動
2. [ ] **確認**: フォーカスリングが表示される
3. [ ] **確認**: `aria-label="Open Settings"` が設定されている（スクリーンリーダーでテスト可能）

---

## テスト2: モデル名の空文字列許可（不具合2の修正検証）

### 2.1 モデル名フィールドの初期状態

1. [ ] 設定画面を開く（歯車アイコンまたは `about:addons` → 設定）
2. [ ] **確認**: API Settings タブが表示されている
3. [ ] **確認**: Model Name フィールドにデフォルト値 `google/gemini-2.0-flash-exp:free` が表示されている

### 2.2 モデル名を空文字列に変更

1. [ ] Model Name フィールドの値をすべて削除（空文字列にする）
2. [ ] 「Save Settings」ボタンをクリック
3. [ ] **確認**: 「Settings saved successfully!」メッセージが表示される
4. [ ] 設定画面を一度閉じる
5. [ ] 設定画面を再度開く
6. [ ] **確認**: Model Name フィールドが**空文字列のまま保持されている**
7. [ ] **確認**: デフォルト値 `google/gemini-2.0-flash-exp:free` に**戻っていない**

### 2.3 空文字列から値を再設定

1. [ ] Model Name フィールドに `openai/gpt-4-turbo` を入力
2. [ ] 「Save Settings」ボタンをクリック
3. [ ] **確認**: 正常に保存される
4. [ ] 設定画面を再読み込み
5. [ ] **確認**: Model Name フィールドに `openai/gpt-4-turbo` が表示される

### 2.4 他の設定フィールドの ?? 演算子確認

1. [ ] Target Language を変更して保存
2. [ ] **確認**: 正常に保存される
3. [ ] Font Size を変更して保存
4. [ ] **確認**: 正常に保存される
5. [ ] Dark Mode を切り替えて保存
6. [ ] **確認**: 正常に保存される

---

## テスト3: Translateボタンの動作（不具合3の修正検証）

### 3.1 ポップアップのTranslateボタン確認

1. [ ] APIキーが設定されていることを確認
2. [ ] 任意のWebページ（例: https://example.com）を開く
3. [ ] 拡張機能のポップアップを開く
4. [ ] **確認**: 「Translate」ボタンが表示されている
5. [ ] 「Translate」ボタンをクリック
6. [ ] **確認**: ページ全体が翻訳される（ローディング表示が出る）
7. [ ] **確認**: StatusIndicator にステータスが表示される
8. [ ] **確認**: ブラウザコンソール（F12 → Console）にエラーが**表示されない**

### 3.2 background.firefox.ts のメッセージハンドリング確認

1. [ ] Firefoxのブラウザコンソール（`about:debugging` → Inspect）を開く
2. [ ] ポップアップの「Translate」ボタンをクリック
3. [ ] **確認**: コンソールに `CommandHandler: Unknown message type` エラーが**表示されない**
4. [ ] **確認**: メッセージが正常にcontent scriptに転送されている（ログ確認）

### 3.3 CommandHandler.handleMessage の動作確認

1. [ ] Webページのテキストを選択
2. [ ] キーボードショートカット `Alt+Y` を押す（Translate Selection）
3. [ ] **確認**: 選択したテキストが翻訳される
4. [ ] クリップボードにテキストをコピー
5. [ ] キーボードショートカット `Alt+C` を押す（Translate Clipboard）
6. [ ] **確認**: クリップボードの内容が翻訳される
7. [ ] キーボードショートカット `Alt+W` を押す（Translate Page）
8. [ ] **確認**: ページ全体が翻訳される

### 3.4 エラーハンドリング確認

1. [ ] APIキーを無効な値に変更
2. [ ] 「Translate」ボタンをクリック
3. [ ] **確認**: エラーメッセージが表示される
4. [ ] **確認**: ブラウザがクラッシュしない
5. [ ] APIキーを正しい値に戻す

---

## 統合テスト

### 全機能の連携確認

1. [ ] 新しいFirefoxプロファイルで拡張機能をロード
2. [ ] ポップアップを開く
3. [ ] **確認**: 歯車アイコンと警告バナーが表示される
4. [ ] 歯車アイコンから設定画面を開く
5. [ ] APIキーを入力、Model Nameを空文字列にして保存
6. [ ] ポップアップを再度開く
7. [ ] **確認**: 歯車アイコンが表示され、警告バナーが非表示
8. [ ] 任意のページで「Translate」ボタンをクリック
9. [ ] **確認**: ページが正常に翻訳される

### リグレッションテスト

1. [ ] Chrome環境でも同じ修正が動作することを確認（可能であれば）
2. [ ] 既存の翻訳機能（Selection, Clipboard, Page）が正常動作
3. [ ] ダークモード切り替えが正常動作
4. [ ] 言語設定変更が正常動作

---

## テスト結果記録

| テスト項目 | 結果 | 備考 |
|----------|------|------|
| 1.1 APIキー未設定時の表示 | ☐ Pass / ☐ Fail | |
| 1.2 APIキー設定後の表示 | ☐ Pass / ☐ Fail | |
| 1.3 歯車アイコンの動作 | ☐ Pass / ☐ Fail | |
| 1.4 アクセシビリティ | ☐ Pass / ☐ Fail | |
| 2.1 モデル名の初期状態 | ☐ Pass / ☐ Fail | |
| 2.2 空文字列への変更 | ☐ Pass / ☐ Fail | |
| 2.3 空文字列から再設定 | ☐ Pass / ☐ Fail | |
| 2.4 他の設定の動作 | ☐ Pass / ☐ Fail | |
| 3.1 Translateボタン確認 | ☐ Pass / ☐ Fail | |
| 3.2 メッセージハンドリング | ☐ Pass / ☐ Fail | |
| 3.3 CommandHandler動作 | ☐ Pass / ☐ Fail | |
| 3.4 エラーハンドリング | ☐ Pass / ☐ Fail | |
| 統合テスト | ☐ Pass / ☐ Fail | |
| リグレッションテスト | ☐ Pass / ☐ Fail | |

---

## 不具合発見時の対応

不具合を発見した場合は、以下の情報を記録してください：

1. **再現手順**: 不具合が発生する詳細な手順
2. **期待される動作**: 本来あるべき動作
3. **実際の動作**: 実際に発生した動作
4. **環境情報**:
   - Firefoxバージョン
   - OS
   - 拡張機能バージョン
5. **ブラウザコンソールのエラーログ**
6. **スクリーンショットまたは動画**

---

**テスト実施日**: ___________
**テスト実施者**: ___________
**テスト環境**: Firefox _____ / OS _____
